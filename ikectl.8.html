<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<title>
IKECTL(8)</title>
    <script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-35930566-1']);
	_gaq.push(['_trackPageview']);
	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
    </script>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
IKECTL(8)</td>
<td class="head-vol">
System Manager's Manual</td>
<td class="head-rtitle">
IKECTL(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">ikectl</b> &#8212; <span class="desc">control the IKEv2 daemon</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 6.00ex;"/>
<col/>
<tbody>
<tr>
<td>
ikectl</td>
<td>
[<span class="opt"><b class="flag">-q</b></span>] [<span class="opt"><b class="flag">-s</b> <i class="arg">socket</i></span>] <i class="arg">command</i> [<span class="opt"><i class="arg">arg ...</i></span>]</td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">ikectl</b> program controls the <a class="link-man">iked(8)</a> daemon and provides commands to maintain a simple X.509 certificate authority (CA) for IKEv2 peers.<div class="spacer">
</div>
The options are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-q</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Don't ask for confirmation of any default options.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-s</b> <i class="arg">socket</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Use <i class="arg">socket</i> instead of the default <i class="file">/var/run/iked.sock</i> to communicate with <a class="link-man">iked(8)</a>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x494b454420434f4e54524f4c20434f4d4d414e4453">IKED CONTROL COMMANDS</h1> The following commands are available to control <a class="link-man">iked(8)</a>:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">active</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set <a class="link-man">iked(8)</a> to active mode.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">passive</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set <a class="link-man">iked(8)</a> to passive mode. In passive mode no packets are sent to peers and no connections are initiated by <a class="link-man">iked(8)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">couple</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Load the negotiated security associations (SAs) and flows into the kernel.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">decouple</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Unload the negotiated SAs and flows from the kernel. This mode is only useful for testing and debugging.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">load</b> <i class="arg">filename</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Reload the configuration from the specified file.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">log brief</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Disable verbose logging.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">log verbose</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enable verbose logging.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">monitor</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Monitor internal messages of the <a class="link-man">iked(8)</a> subsystems.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">reload</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Reload the configuration from the default configuration file.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">reset all</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Reset the running state.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">reset ca</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Reset the X.509 CA and certificate state.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">reset policy</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Flush the configured policies.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">reset sa</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Flush the running SAs.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">reset user</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Flush the local user database.</dd>
</dl>
</div>
<div class="section">
<h1 id="x504b4920414e4420434552544946494341544520415554484f5249545920434f4d4d414e4453">PKI AND CERTIFICATE AUTHORITY COMMANDS</h1> In order to use public key based authentication with IKEv2, a public key infrastructure (PKI) has to be set up to create and sign the peer certificates. <b class="name">ikectl</b> includes commands to simplify maintenance of the PKI and to set up a simple certificate authority (CA) for <a class="link-man">iked(8)</a> and its peers.<div class="spacer">
</div>
The following commands are available to control the CA:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ca</b> <i class="arg">name</i> <b class="flag">create</b> [<span class="opt"><b class="flag">password</b> <i class="arg">password</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Create a new certificate authority with the specified <i class="arg">name</i>. The command will prompt for a CA password unless it is specified with the optional <i class="arg">password</i> argument. The password will be saved in a protected file <i class="file">ikeca.passwd</i> in the CA directory and used for subsequent commands.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ca</b> <i class="arg">name</i> <b class="flag">delete</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Delete the certificate authority with the specified <i class="arg">name</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ca</b> <i class="arg">name</i> <b class="flag">export</b> [<span class="opt"><b class="flag">peer</b> <i class="arg">peer</i></span>] [<span class="opt"><b class="flag">password</b> <i class="arg">password</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Export the certificate authority with the specified <i class="arg">name</i> into the current directory for transport to other systems. This command will create a compressed tarball called <i class="file">ca.tgz</i> in the local directory and optionally <i class="file">ca.zip</i> if the &#8216;zip&#8217; tool is installed. The optional <i class="arg">peer</i> argument can be used to specify the address or FQDN of the local gateway which will be written into a text file <i class="file">peer.txt</i> and included in the archives.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ca</b> <i class="arg">name</i> <b class="flag">install</b> [<span class="opt"><i class="arg">path</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Install the certificate and Certificate Revocation List (CRL) for CA <i class="arg">name</i> as the currently active CA or into the specified <i class="arg">path</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ca</b> <i class="arg">name</i> <b class="flag">certificate</b> <i class="arg">host</i> <b class="flag">create</b> [<span class="opt"><b class="cmd">server</b> | <b class="cmd">client</b></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Create a private key and certificate for <i class="arg">host</i> and sign then with the key of certificate authority with the specified <i class="arg">name</i>.<div class="spacer">
</div>
The certificate will be valid for client and server authentication by default by setting both flags as the extended key usage in the certificate; this can be restricted using the optional <b class="cmd">server</b> or <b class="cmd">client</b> argument.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ca</b> <i class="arg">name</i> <b class="flag">certificate</b> <i class="arg">host</i> <b class="flag">delete</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Deletes the private key and certificates associated with <i class="arg">host</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ca</b> <i class="arg">name</i> <b class="flag">certificate</b> <i class="arg">host</i> <b class="flag">export</b> [<span class="opt"><b class="flag">peer</b> <i class="arg">peer</i></span>] [<span class="opt"><b class="flag">password</b> <i class="arg">password</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Export key files for <i class="arg">host</i> of the certificate authority with the specified <i class="arg">name</i> into the current directory for transport to other systems. This command will create a compressed tarball <i class="file">host.tgz</i> in the local directory and optionally <i class="file">host.zip</i> if the &#8216;zip&#8217; tool is installed. The optional <i class="arg">peer</i> argument can be used to specify the address or FQDN of the local gateway which will be written into a text file <i class="file">peer.txt</i> and included in the archives.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ca</b> <i class="arg">name</i> <b class="flag">certificate</b> <i class="arg">host</i> <b class="flag">install</b> [<span class="opt"><i class="arg">path</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Install the private and public key for <i class="arg">host</i> into the active configuration or specified <i class="arg">path</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ca</b> <i class="arg">name</i> <b class="flag">certificate</b> <i class="arg">host</i> <b class="flag">revoke</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Revoke the certificate specified by <i class="arg">host</i> and generate a new Certificate Revocation List (CRL).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">show</b> <b class="flag">ca</b> <i class="arg">name</i> <b class="flag">certificates</b> [<span class="opt"><i class="arg">host</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Display a listing of certificates associated with CA <i class="arg">name</i> or display certificate details if <i class="arg">host</i> is specified.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ca</b> <i class="arg">name</i> <b class="flag">key</b> <i class="arg">host</i> <b class="flag">create</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Create a private key for <i class="arg">host</i> if one does not already exist.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ca</b> <i class="arg">name</i> <b class="flag">key</b> <i class="arg">host</i> <b class="flag">install</b> [<span class="opt"><i class="arg">path</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Install the private and public keys for <i class="arg">host</i> into the active configuration or specified <i class="arg">path</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ca</b> <i class="arg">name</i> <b class="flag">key</b> <i class="arg">host</i> <b class="flag">delete</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Delete the private key for <i class="arg">host</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ca</b> <i class="arg">name</i> <b class="flag">key</b> <i class="arg">host</i> <b class="flag">import</b> <i class="arg">file</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Source the private key for <i class="arg">host</i> from the named <i class="arg">file</i>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/iked/</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Active configuration.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/ssl/</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Directory to store the CA files.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/usr/share/iked</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
If this optional directory exists, <b class="name">ikectl</b> will include the contents with the <b class="flag">ca export</b> commands.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/var/run/iked.sock</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
default <span class="unix">UNIX</span>-domain socket used for communication with <a class="link-man">iked(8)</a></dd>
</dl>
</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> First create a new certificate authority:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# ikectl ca vpn create</pre>
<div class="spacer">
</div>
Now create the certificates for the VPN peers. The specified hostname, either IP address or FQDN, will be saved in the signed certificate and has to match the IKEv2 identity, or <i class="arg">srcid</i>, of the peers:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# ikectl ca vpn certificate 10.1.2.3 create 
# ikectl ca vpn certificate 10.2.3.4 create 
# ikectl ca vpn certificate 10.3.4.5 create</pre>
<div class="spacer">
</div>
It is possible that the host that was used to create the CA is also one of the VPN peers. In this case you can install the peer and CA certificates locally:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# ikectl ca vpn install 
# ikectl ca vpn certificate 10.1.2.3 install</pre>
<div class="spacer">
</div>
Now export the individual host key, the certificate and the CA certificate to each other peer. First run the <b class="cmd">export</b> command to create tarballs that include the required files:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# ikectl ca vpn certificate 10.2.3.4 export 
# ikectl ca vpn certificate 10.3.4.5 export</pre>
<div class="spacer">
</div>
These commands will produce two tarballs <span class="emph">10.2.3.4.tgz</span> and <span class="emph">10.3.4.5.tgz</span>. Copy these tarballs over to the appropriate peers and extract them to the <i class="file">/etc/iked/</i> directory:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
10.2.3.4# tar -C /etc/iked -xzpf 10.2.3.4.tgz 
10.3.4.5# tar -C /etc/iked -xzpf 10.3.4.5.tgz</pre>
<div class="spacer">
</div>
<b class="name">ikectl</b> will also create &#8216;zip&#8217; archives 10.2.3.4.zip and 10.3.4.5.zip in addition to the tarballs if the zip tool is found in <i class="file">/usr/local/bin/zip</i>. These archives can be exported to peers running Windows and will include the certificates in a format that is supported by the OS. The zip tool can be installed from the <span class="unix">OpenBSD</span> packages or ports collection before running the <b class="cmd">export</b> commands, see <a class="link-man">packages(7)</a> for more information. For example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# pkg_add zip</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man">packages(7)</a>, <a class="link-man">iked(8)</a>, <a class="link-man">ssl(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">ikectl</b> program first appeared in <span class="unix">OpenBSD&#160;4.8</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> The <b class="name">ikectl</b> program was written by <span class="author">Reyk Floeter</span> &lt;<a class="link-mail" href="mailto:reyk@openbsd.org">reyk@openbsd.org</a>&gt; and<br/>
<span class="author">Jonathan Gray</span> &lt;<a class="link-mail" href="mailto:jsg@openbsd.org">jsg@openbsd.org</a>&gt;.</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> For ease of use, the <b class="cmd">ca</b> commands maintain all peers' private keys on the CA machine. In contrast to a &#8216;real&#8217; CA, it does not support signing of public keys that have been imported from peers that do not want to expose their private keys to the CA.</div>
<table class="foot">
<tbody>
<tr>
<td class="foot-date">
July 27, 2015</td>
<td class="foot-os">
OpenBSD 5.8</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

